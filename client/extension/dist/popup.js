import{c as B,j as t,r as a,B as S,T as s,C as l,a as d,b as f,d as C,e as T,R as k,f as I,g as E}from"./CardContent.js";const b=B(t.jsx("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security"),R=()=>{const[u,m]=a.useState([]),[c,g]=a.useState(!1),[h,p]=a.useState(null);a.useEffect(()=>{x(),j()},[]);const j=async()=>{try{console.log("Testing background connection...");const e=await chrome.runtime.sendMessage({action:"ping"});console.log("Background ping response:",e)}catch(e){console.error("Background connection test failed:",e)}},v=async()=>{try{console.log("Testing auto-scan...");const e=await chrome.runtime.sendMessage({action:"testAutoScan"});console.log("Auto-scan test response:",e),e.success?alert(`Auto-scan test: ${e.message}`):alert(`Auto-scan test failed: ${e.error}`)}catch(e){console.error("Auto-scan test failed:",e),alert(`Auto-scan test error: ${e.message}`)}},x=async()=>{try{const e=await chrome.runtime.sendMessage({action:"getScanHistory"});m(e||[])}catch(e){console.error("Failed to load data:",e)}},w=async()=>{try{g(!0),p(null);const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.id||!e.url)throw new Error("No active tab found");if(!["chat.openai.com","chatgpt.com","claude.ai","bard.google.com","openai.com","anthropic.com"].some(n=>e.url.includes(n)))throw new Error(`Current tab is not a supported AI platform. URL: ${e.url}`);const y={platform:A(e.url),url:e.url,tabId:e.id,context:{messages:[],metadata:{url:e.url,timestamp:new Date().toISOString()}},timestamp:new Date().toISOString(),tests:["prompt-injection","jailbreaking","role-confusion","data-exfiltration"]};console.log("Sending scan message to background:",{action:"scanAgent",data:y});const o=await Promise.race([chrome.runtime.sendMessage({action:"scanAgent",data:y}),new Promise((n,i)=>setTimeout(()=>i(new Error("Background script timeout")),1e4))]);if(console.log("Popup received response:",o),o&&o.success){const n=o.data;m(i=>[n,...i])}else throw new Error((o==null?void 0:o.error)||"Scan failed - no response from background script");await x()}catch(e){console.error("Scan error details:",e),p(`Scan failed: ${e.message}`)}finally{g(!1)}},A=e=>e.includes("chat.openai.com")||e.includes("chatgpt.com")||e.includes("openai.com")?"ChatGPT":e.includes("claude.ai")||e.includes("anthropic.com")?"Claude":e.includes("bard.google.com")||e.includes("google.com")?"Bard":"Unknown",r=u[0];return t.jsxs(S,{sx:{width:400,height:600,p:2},children:[t.jsxs(S,{sx:{textAlign:"center",mb:3},children:[t.jsx(b,{sx:{fontSize:48,color:"primary.main",mb:1}}),t.jsx(s,{variant:"h5",component:"h1",gutterBottom:!0,children:"AgentShield"}),t.jsx(s,{variant:"body2",color:"text.secondary",children:"AI Agent Security Scanner"})]}),h&&t.jsx(l,{sx:{mb:2,bgcolor:"error.light"},children:t.jsx(d,{children:t.jsx(s,{variant:"body2",color:"error.contrastText",children:h})})}),t.jsx(f,{variant:"contained",fullWidth:!0,startIcon:t.jsx(b,{}),onClick:w,disabled:c,sx:{mb:2},children:c?"Scanning...":"Scan Current Tab"}),t.jsx(f,{variant:"outlined",fullWidth:!0,onClick:v,sx:{mb:2},children:"Test Auto-Scan"}),r&&t.jsx(l,{children:t.jsxs(d,{children:[t.jsx(s,{variant:"h6",gutterBottom:!0,children:"Latest Scan Results"}),t.jsxs(s,{variant:"body2",color:"text.secondary",children:["Domain: ",r.domain]}),t.jsxs(s,{variant:"body2",color:"text.secondary",children:["Risk Score: ",r.results.score,"/100"]}),t.jsxs(s,{variant:"body2",color:"text.secondary",children:["Severity: ",r.results.severity]}),t.jsxs(s,{variant:"body2",color:"text.secondary",children:["Tests Passed: ",r.results.tests.filter(e=>e.passed).length,"/",r.results.tests.length]})]})}),u.length===0&&!c&&t.jsx(l,{children:t.jsxs(d,{sx:{textAlign:"center",py:4},children:[t.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Scans Yet"}),t.jsx(s,{variant:"body2",color:"text.secondary",children:'Click "Scan Current Tab" to start scanning AI agents for security vulnerabilities.'})]})})]})},M=C({palette:{primary:{main:"#1976d2"},secondary:{main:"#dc004e"}},typography:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},components:{MuiButton:{styleOverrides:{root:{textTransform:"none"}}}}});T.createRoot(document.getElementById("root")).render(t.jsx(k.StrictMode,{children:t.jsxs(I,{theme:M,children:[t.jsx(E,{}),t.jsx(R,{})]})}));
